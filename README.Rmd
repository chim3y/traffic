---
title: "Traffic flow analysis in AUSA toll booths"
author: "Julián Ailán"
output:
  html_document:
    toc: true
    toc_depth: 2
  md_document:
    variant: markdown_github
params:
  date: !r Sys.Date()
---

This project consists on analyzing the evolution of traffic on AUSA toll booths in Buenos Aires highways. The data being used in this project can be found on the [Buenos Aires Data](https://data.buenosaires.gob.ar/dataset/flujo-vehicular-por-unidades-de-peaje-ausa) site. 

### Objective
The main aim of this project is being able to predict the amount of vehicles going in and out of the city for a given date in the future. So, if given a day $d_i$, the model will be able to predict the traffic volume on day $d_{i+1}$.

### Structure of the data to use
The information provided consists of 11 files, one for each year from 2008 to 2018. There is no strict convention on the columns naming, neither on whether categorical values are stored with uppercase letters or a mixture of uppercase and lowercase. To standardize everything to the same criteria, several transformations were performed.

The .csv files provide in each entry an estimate of the amount of vehicles that went through a certain toll both in an interval of time of one hour. The following is the detail of each column:

* PERIODO: indicates the **year**.
* FECHA: indicates the **full date** in *dd/mm/yyyy* format.
* DIA: indicates the **day of the week**.
* HORA: indicates the **start time of the interval**.
* HORA_FIN: indicates the **end time of the interval**. 
* ESTACION: indicates the **name of the toll booth**.
* TIPO_VEHICULO: indicates whether the vehicle was a **truck or a car**. 
* FORMA_PAGO: indicates if the **payment method**.
* CANTIDAD_PASOS: indicates the **number of vehicles** that went through the toll booth at that interval of time, and payed with a given payment method.

For example:
```{r}
df <- read.csv('~/Documents/traffic/datasets/traffic.csv')
head(df)
```

### Exploratory analysis
The tool used to perform aggregations and other operations over dataframes is the dplyr package.
```{r}
library(dplyr)
```

As a way of starting to know this dataset, we can see that there is a difference on the amount of entries in each file of our dataset.
```{r}
volume.per.year <- df %>%
    group_by(PERIODO) %>% 
    summarise(CANTIDAD_PASOS = sum(CANTIDAD_PASOS))
trend <- lm(volume.per.year$CANTIDAD_PASOS ~ volume.per.year$PERIODO)
plot(volume.per.year$CANTIDAD_PASOS ~ volume.per.year$PERIODO, 
     xlab = 'Time (years)', ylab = 'Number of vehicles')
abline(trend, col = 'red')
```

For the graph above it's clear there's an order of magnitud of difference between the amount of vehicles in the period 2008-2013 versus the period 2014-2018. This doesn't mean the number of vehicles skyrocketed in a matter of two years, but rather that new toll booth locations were added to the dataset along those years, which ended up adding 10x more information. To make this evident, compare the amount of toll booths on this heatmap from 2013
```{r}
library(ggplot2)
features <- c('ESTACION', 'DIA', 'CANTIDAD_PASOS', 'PERIODO')
t <- df[features]; rm(features)
t <- rbind(t %>%
            filter(PERIODO == '2013') %>%
            group_by(ESTACION, DIA) %>%
            summarise(CANTIDAD_PASOS = sum(CANTIDAD_PASOS)))
t <- t %>% arrange(ESTACION, DIA)
p <- ggplot(t, aes(x = DIA, y = ESTACION, fill = CANTIDAD_PASOS)) +
  geom_tile() +
  geom_text(aes(label = CANTIDAD_PASOS), size = 3) +
  scale_fill_gradient(low = 'white', high = 'steelblue') +
  scale_x_discrete(expand = c(0, 0)) + 
  scale_y_discrete(expand = c(0, 0)) +
  labs(x = '', y = '') +
  coord_equal() +
  theme_bw()
plot(p)
```

with those on this other one from 2015:

```{r}
features <- c('ESTACION', 'DIA', 'CANTIDAD_PASOS', 'PERIODO')
t <- df[features]; rm(features)
t <- rbind(t %>%
            filter(PERIODO == '2015') %>%
            group_by(ESTACION, DIA) %>%
            summarise(CANTIDAD_PASOS = sum(CANTIDAD_PASOS)))
t <- t %>% arrange(ESTACION, DIA)
p <- ggplot(t, aes(x = DIA, y = ESTACION, fill = CANTIDAD_PASOS)) +
  geom_tile() +
  geom_text(aes(label = CANTIDAD_PASOS), size = 3) +
  scale_fill_gradient(low = 'white', high = 'steelblue') +
  scale_x_discrete(expand = c(0, 0)) + 
  scale_y_discrete(expand = c(0, 0)) +
  labs(x = '', y = '') +
  coord_equal() +
  theme_bw()
plot(p)
```